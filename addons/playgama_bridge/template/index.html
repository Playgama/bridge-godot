<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang=" xml:lang=">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, user-scalable=no" />
    <title>$GODOT_PROJECT_NAME</title>
    <style type="text/css">
        html {
            overflow: hidden;
        }

        body {
            touch-action: none;
            margin: 0;
            border: 0 none;
            padding: 0;
            text-align: center;
            background-color: black;
            overflow: hidden;
        }

        #canvas {
            display: block;
            margin: 0;
            color: white;
        }

        #canvas:focus {
            outline: none;
        }

        .godot {
            font-family: 'Noto Sans', 'Droid Sans', Arial, sans-serif;
            color: #e0e0e0;
            background-color: #3b3943;
            background-image: linear-gradient(to bottom, #403e48, #35333c);
            border: 1px solid #45434e;
            box-shadow: 0 0 1px 1px #2f2d35;
        }
    </style>
$GODOT_HEAD_INCLUDE
</head>
<body>
    <canvas id="canvas">
        HTML5 canvas appears to be unsupported in the current browser.<br />
        Please try updating or use a different browser.
    </canvas>
    <script type="text/javascript" src="$GODOT_URL"></script>
    <script type="text/javascript">//<![CDATA[
        const GODOT_CONFIG = $GODOT_CONFIG
        const ENGINE = new Engine(GODOT_CONFIG)
        const CANVAS = document.getElementById('canvas')

        let bridgeScript = null
        let bridgeTimeout = null
        let bridgeLoaded = false

        function addLocalBridge() {
            if (bridgeLoaded) return
            bridgeLoaded = true
            clearTimeout(bridgeTimeout)

            if (bridgeScript && bridgeScript.parentNode) {
                bridgeScript.onload = null
                bridgeScript.onerror = null
                bridgeScript.src = ''
                bridgeScript.parentNode.removeChild(bridgeScript)

            }

            const scriptElement = document.createElement('script')
            scriptElement.src = './playgama-bridge.js'
            document.body.appendChild(scriptElement)
            scriptElement.onload = function() {
                initializeBridge()
            }
        }

        bridgeScript = document.createElement('script')
        bridgeScript.src = 'https://bridge.playgama.com/v1/stable/playgama-bridge.js'
        bridgeScript.onload = initializeBridge
        bridgeScript.onerror = addLocalBridge

        bridgeTimeout = setTimeout(() => {
            console.warn('CDN bridge failed to load within 2 seconds, loading local bridge')
            addLocalBridge()
        }, 2000)

        document.head.appendChild(bridgeScript)

        function initializeBridge() {
            bridge.engine = 'godot-3'
            bridge.initialize().then(() => {
                bridge.game.setLoadingProgress(0)
                ENGINE.startGame({
                    onProgress: function (current, total) {
                        bridge.game.setLoadingProgress((current / total) * 100)
                    },
                }).then(() => {
                    CANVAS.focus()
                })
            })
        }
    //]]></script>

</body>
</html>                                                                                                                                                  